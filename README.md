# Assets Endpoint Project

The scope of this project is to demonstrate the potential of the integrated models to represents assets for their owners and admin users. 

for this purpose a mini system is developed to test and prove the functionality of models as an integrated system to get the desired result.
#
>Please note that the purpose of the system is just to demonstrate a clear architecture of models and to run tests and should not be considered as a production code.

### Models 
For this system, Assets, Group and User models are designed to handle following relation ships:
#
- Many-to-many relationship beetween groups and assets
- Many-to-many relationship between groups and users
- Many-to-many relationship between users and assets through groups

this approach  makes system able to handle as many as relationships between assets, groups and users.
#


>For the sake of simplicity and focus on the functional requirement of the project user roles are handled as an attribute within the User model which should be implemented in different way in a real project according to it's defined purpose.


### Database 
>There is an in-memory sqlite database in this system for testing purpose (only). however the schema can be migrated to a real mysql database.

For the purpose of implementing many-to-many relationship, there are 3 main tables of 'users', 'assets' and 'groups' within the schema long with 2 pivot tables 'asset_group' and 'user_group' to to handle the relations between main tables.

### Unit test
#
>This project has been developed in TDD approach

##### Admin can see all assets
#
    /**
     * @test
     */
    public function admin_can_see_all_assets()
    {
        // genrate 5 groups, including their assets and users and their relations
        $groups = factory('App\Group', 5)->create();
        // all assets stored in database
        $assetsAmount = Asset::all()->count();
        // a new user generated and logs in as an admin (has no asset)
        $user = factory('App\User')->create(['role' => 0]);
        $this->actingAs($user);
        //verify the user is admin
        $this->assertTrue($user->isAdmin());
        //call API to retrive assets
        $response = json_decode($this->get('/api/assets')->getContent(), true);
        // admin gets all assets
        $this->assertCount($assetsAmount, $response);
    }

   
##### User cannot see other's assets
#
    /**
     * @test
     */
    public function user_only_sees_own_his_assets()
    {
        // genrate a group, including their assets and users and their relations
        $group = factory('App\Group', 5)->create();
        // all assets stored in database
        $allAssetsAmount = Asset::all()->count();
        // one of the assets' owners logs in
        $normalUser = $group->first()->users()->first();
        $this->actingAs($normalUser);
        //verify user is not admin
        $this->assertFalse($normalUser->isAdmin());
        //call API to retrive assets
        $normalUserAssets =  json_decode($this->get('/api/assets')->getContent(), true);
        // user only sees his assets
        $this->assertCount($normalUser->assets()->count(), $normalUserAssets);
        $this->assertTrue($allAssetsAmount > count($normalUserAssets));
    }
   
#####  Asset mockup response for a non-admin user
# 
#
>Asset names are generated by faker
*note that assets blong to a single group which belongs to the user
#
        array:1 [
      0 => array:3 [
        0 => {#955
          +"id": 1
          +"name": "Sit nulla autem ipsum accusantium."
          +"created_at": "2019-03-23 15:51:41"
          +"updated_at": "2019-03-23 15:51:41"
          +"pivot": {#1023
            +"group_id": "1"
            +"asset_id": "1"
          }
        }
        1 => {#1024
          +"id": 2
          +"name": "Ea vitae omnis aliquid eius quibusdam."
          +"created_at": "2019-03-23 15:51:41"
          +"updated_at": "2019-03-23 15:51:41"
          +"pivot": {#966
            +"group_id": "1"
            +"asset_id": "2"
          }
        }
        2 => {#963
          +"id": 3
          +"name": "Cum est qui voluptatem corrupti."
          +"created_at": "2019-03-23 15:51:41"
          +"updated_at": "2019-03-23 15:51:41"
          +"pivot": {#926
            +"group_id": "1"
            +"asset_id": "3"
          }
        }
      ]
    ]
 
#####  Asset mockup response for an admin user
#    

> note that group_id is changing

      array:5 [
      0 => array:4 [
        0 => array:5 [
          "id" => 1
          "name" => "Reiciendis quo incidunt aut aut voluptas assumenda numquam."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "1"
            "asset_id" => "1"
          ]
        ]
        1 => array:5 [
          "id" => 2
          "name" => "Illum est dolor dolor deserunt placeat."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "1"
            "asset_id" => "2"
          ]
        ]
        2 => array:5 [
          "id" => 3
          "name" => "Cumque rerum enim fugiat et voluptatem est."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "1"
            "asset_id" => "3"
          ]
        ]
        3 => array:5 [
          "id" => 4
          "name" => "Itaque eaque eos accusantium laboriosam officia aut."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "1"
            "asset_id" => "4"
          ]
        ]
      ]
      1 => array:5 [
        0 => array:5 [
          "id" => 5
          "name" => "Nostrum perferendis qui voluptatum rem doloribus officiis nisi."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "2"
            "asset_id" => "5"
          ]
        ]
        1 => array:5 [
          "id" => 6
          "name" => "Quis illo sed nostrum dolorum error."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "2"
            "asset_id" => "6"
          ]
        ]
        2 => array:5 [
          "id" => 7
          "name" => "Odio ut rerum iusto enim."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "2"
            "asset_id" => "7"
          ]
        ]
        3 => array:5 [
          "id" => 8
          "name" => "Animi vel omnis dolores ea sunt sint."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "2"
            "asset_id" => "8"
          ]
        ]
        4 => array:5 [
          "id" => 9
          "name" => "Non iure distinctio esse quisquam."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "2"
            "asset_id" => "9"
          ]
        ]
      ]
      2 => array:2 [
        0 => array:5 [
          "id" => 10
          "name" => "Accusantium in quasi soluta tempora in culpa alias."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "3"
            "asset_id" => "10"
          ]
        ]
        1 => array:5 [
          "id" => 11
          "name" => "Voluptatem mollitia quae quia debitis voluptatibus ut."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "3"
            "asset_id" => "11"
          ]
        ]
      ]
      3 => array:3 [
        0 => array:5 [
          "id" => 12
          "name" => "Atque officiis cum incidunt voluptatem."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "4"
            "asset_id" => "12"
          ]
        ]
        1 => array:5 [
          "id" => 13
          "name" => "Temporibus hic nobis qui autem dolorem."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "4"
            "asset_id" => "13"
          ]
        ]
        2 => array:5 [
          "id" => 14
          "name" => "Est velit voluptatum similique id doloremque asperiores."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "4"
            "asset_id" => "14"
          ]
        ]
      ]
      4 => array:2 [
        0 => array:5 [
          "id" => 15
          "name" => "Culpa qui sed excepturi deleniti."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "5"
            "asset_id" => "15"
          ]
        ]
        1 => array:5 [
          "id" => 16
          "name" => "Veritatis eveniet ipsum amet delectus."
          "created_at" => "2019-03-23 16:18:26"
          "updated_at" => "2019-03-23 16:18:26"
          "pivot" => array:2 [
            "group_id" => "5"
            "asset_id" => "16"
          ]
        ]
      ]
    ]

    
